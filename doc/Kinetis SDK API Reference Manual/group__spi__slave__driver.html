<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Kinetis SDK API Reference Manual: SPI Slave Peripheral Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK API Reference Manual
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Usage</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__spi__slave__driver.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a>  </div>
  <div class="headertitle">
<div class="title">SPI Slave Peripheral Driver<div class="ingroups"><a class="el" href="group__spi.html">Serial Peripheral Interface (SPI)</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This section describes the programming interface of the SPI slave mode Peripheral driver.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structspi__slave__callbacks__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a></td></tr>
<tr class="memdesc:structspi__slave__callbacks__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">The set of callbacks used for SPI slave mode.  <a href="group__spi__slave__driver.html#structspi__slave__callbacks__t">More...</a><br/></td></tr>
<tr class="separator:structspi__slave__callbacks__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structspi__slave__state__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a></td></tr>
<tr class="memdesc:structspi__slave__state__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runtime state of the SPI slave driver.  <a href="group__spi__slave__driver.html#structspi__slave__state__t">More...</a><br/></td></tr>
<tr class="separator:structspi__slave__state__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structspi__slave__user__config__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a></td></tr>
<tr class="memdesc:structspi__slave__user__config__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Definition of application implemented configuration and callback.  <a href="group__spi__slave__driver.html#structspi__slave__user__config__t">More...</a><br/></td></tr>
<tr class="separator:structspi__slave__user__config__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
SPI Slave</h2></td></tr>
<tr class="memitem:ga4b3c6d8bc1e7a39be0c66a7185f3d404"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#ga4b3c6d8bc1e7a39be0c66a7185f3d404">SPI_DRV_SlaveInit</a> (uint32_t instance, <a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> *spiState, const <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> *config)</td></tr>
<tr class="memdesc:ga4b3c6d8bc1e7a39be0c66a7185f3d404"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the SPI module for slave mode.  <a href="#ga4b3c6d8bc1e7a39be0c66a7185f3d404">More...</a><br/></td></tr>
<tr class="separator:ga4b3c6d8bc1e7a39be0c66a7185f3d404"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa181e9e53d025cfde1ee70c503dde448"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#gaa181e9e53d025cfde1ee70c503dde448">SPI_DRV_SlaveInitDma</a> (uint32_t instance, <a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> *spiState, const <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> *slaveConfig, const uint8_t *sendBuffer, uint8_t *receiveBuffer, size_t transferByteCount)</td></tr>
<tr class="memdesc:gaa181e9e53d025cfde1ee70c503dde448"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes an SPI instance for slave mode operation with the DMA support.  <a href="#gaa181e9e53d025cfde1ee70c503dde448">More...</a><br/></td></tr>
<tr class="separator:gaa181e9e53d025cfde1ee70c503dde448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0c716f5dfe61caa7064a5ba8d39b0280"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#ga0c716f5dfe61caa7064a5ba8d39b0280">SPI_DRV_SlaveDeinit</a> (uint32_t instance)</td></tr>
<tr class="memdesc:ga0c716f5dfe61caa7064a5ba8d39b0280"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-initializes the device.  <a href="#ga0c716f5dfe61caa7064a5ba8d39b0280">More...</a><br/></td></tr>
<tr class="separator:ga0c716f5dfe61caa7064a5ba8d39b0280"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>


<h3><a class="anchor" id="spislave"></a>SPI Slave Peripheral Driver</h3><div class="textblock"><h1>Overview</h1>
The SPI slave peripheral driver provides an easy way to use an SPI peripheral in slave mode.Data transfer is performed through callback functions.<h1>Runtime state of the SPI slave driver</h1>
This structure of type <a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t" title="Runtime state of the SPI slave driver. ">spi_slave_state_t</a> holds data that the SPI slave peripheral driver uses to communicate between the transfer function and the interrupt handler. The user needs to pass the memory for this structure and the driver fills out the members.<h1>Callbacks</h1>
To use this driver, first define several application callbacks. These are the callback functions that are set in the <a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t" title="The set of callbacks used for SPI slave mode. ">spi_slave_callbacks_t</a> structure.The three callbacks are:</p>
<ul>
<li>Data source</li>
<li>Data sink</li>
<li>Error notification</li>
</ul>
The first two callbacks are used to send and receive data. The third callback is invoked if an error occurs.The prototypes for the three callbacks are: </p>
<div class="fragment"><div class="line">status_t dataSource(uint8_t * sourceByte, uint16_t instance);</div>
<div class="line"></div>
<div class="line">status_t dataSink(uint8_t sinkByte, uint16_t instance);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> onError(status_t error);</div>
</div><!-- fragment -->All callbacks are invoked from IRQ state.<h1>Setup</h1>
SPI Slave Interrupt Driven: To initialize the SPI slave driver, first create and fill in the #spi_slave_config_t structure. This structure defines the callbacks and data format settings for the SPI peripheral. The structure is not required after the driver is initialized and can be allocated on the stack.This is an example of a config struct definition and SPI slave initialization: </p>
<div class="fragment"><div class="line"><a class="code" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> slaveUserConfig;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a5a82acc2f86bf8d78ce3a489ba720760">polarity</a> = <a class="code" href="group__spi__hal.html#gga3e5a7cd043c9596779bc23b34cb3d1f9a0b33c8e75da2f2c6a2e821f94cc77f46">kSpiClockPolarity_ActiveHigh</a>;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a421ac6406636a059ebbb874d8b25edb3">phase</a> = <a class="code" href="group__spi__hal.html#gga9ad313685ade497f5cbcb71c74a1b4dcaac180df70db6fa5463501e6b7a38a183">kSpiClockPhase_FirstEdge</a>;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a817f018aa9558eb4b153682a6d15d1a2">direction</a> = <a class="code" href="group__spi__hal.html#ggaa68518c16202382c2e1f1c7c66a9d53daefa27165c331b1503fd02a79099e8dfe">kSpiMsbFirst</a>;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a31ffb0aefd629bd78e352ff7f7ca55d5">callbacks</a>.<a class="code" href="group__spi__slave__driver.html#a816f6cc0a2d4fa093100080f4a824c2d">dataSink</a> = data_sink;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a31ffb0aefd629bd78e352ff7f7ca55d5">callbacks</a>.<a class="code" href="group__spi__slave__driver.html#a6066290d2a7cc21f09042381f4433cdd">dataSource</a> = data_source;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a31ffb0aefd629bd78e352ff7f7ca55d5">callbacks</a>.<a class="code" href="group__spi__slave__driver.html#a756904ea43a3e516f4602b49cb639278">onError</a> = on_error;</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> spiSlaveState;</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__spi__slave__driver.html#ga4b3c6d8bc1e7a39be0c66a7185f3d404">SPI_DRV_SlaveInit</a>(slaveInstance, &amp;spiSlaveState, &amp;slaveUserConfig);</div>
</div><!-- fragment -->SPI Slave DMA Driven: Additionally, the SPI supports DMA transfers.The usage of the SPI slave mode with DMA is slightly different than that of the interrupt driven driver. In the case of DMA usage, the user also passes in the send and receive buffer pointers along with the expected amount of data that wish to transfer. This is needed by the DMA engine.There is no need to define callbacks for the data source and sink. However, an optional callback may be needed to handle errors. Also, an additional new callback is needed from the user to handle the completion of the DMA transfer, which can be as simple as setting a global flag to indicate that the transfer is done. This is an example usage.To use the SPI with DMA, simply call an alternate initialization function: SPI_DRV_SlaveInitDma: </p>
<div class="fragment"><div class="line"><span class="comment">/* Function prototype */</span></div>
<div class="line"><a class="code" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a> <a class="code" href="group__spi__slave__driver.html#gaa181e9e53d025cfde1ee70c503dde448">SPI_DRV_SlaveInitDma</a>(uint32_t instance,</div>
<div class="line">                                  <a class="code" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> * spiState,</div>
<div class="line">                                  <span class="keyword">const</span> <a class="code" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> * slaveConfig,</div>
<div class="line">                                  <span class="keyword">const</span> uint8_t * sendBuffer,</div>
<div class="line">                                  uint8_t * receiveBuffer,</div>
<div class="line">                                  <span class="keywordtype">size_t</span> transferByteCount)</div>
</div><!-- fragment -->Example usage: </p>
<div class="fragment"><div class="line">instance = slaveInstance; &lt;- the desired module instance number</div>
<div class="line"><a class="code" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> spiSlaveState; &lt;- the user simply allocates memory <span class="keywordflow">for</span> <span class="keyword">this</span> <span class="keyword">struct</span></div>
<div class="line"><a class="code" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> slaveUserConfig;</div>
<div class="line">slaveUserConfig.<a class="code" href="group__spi__slave__driver.html#a31ffb0aefd629bd78e352ff7f7ca55d5">callbacks</a>.<a class="code" href="group__spi__slave__driver.html#a756904ea43a3e516f4602b49cb639278">onError</a> = on_error; &lt;- set to user implementation of <span class="keyword">function</span></div>
<div class="line">slaveUserConfig.callbacks.spi_slave_done_t = spi_Dma_Done; &lt;- user defined callback</div>
<div class="line">slaveUserConfig.polarity = <a class="code" href="group__spi__hal.html#gga3e5a7cd043c9596779bc23b34cb3d1f9a0b33c8e75da2f2c6a2e821f94cc77f46">kSpiClockPolarity_ActiveHigh</a>;</div>
<div class="line">slaveUserConfig.phase = <a class="code" href="group__spi__hal.html#gga9ad313685ade497f5cbcb71c74a1b4dcaac180df70db6fa5463501e6b7a38a183">kSpiClockPhase_FirstEdge</a>;</div>
<div class="line">slaveUserConfig.direction = <a class="code" href="group__spi__hal.html#ggaa68518c16202382c2e1f1c7c66a9d53daefa27165c331b1503fd02a79099e8dfe">kSpiMsbFirst</a>;</div>
<div class="line">sendBuffer &lt;- (pointer) to the source data buffer, can be NULL</div>
<div class="line">receiveBuffer &lt;- (pointer) to the receive data buffer, can be NULL</div>
<div class="line">transferCount &lt;- number of bytes to transfer</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__spi__slave__driver.html#gaa181e9e53d025cfde1ee70c503dde448">SPI_DRV_SlaveInitDma</a>(slaveInstance, &amp;slaveUserConfig, &amp;spiSlaveState,</div>
<div class="line">                    &amp;sendBuffer, &amp;receiveBuffer, transferCount);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Here is an example of the callback to indicate completion of the DMA. Note</span></div>
<div class="line"><span class="comment"> * the name of this callback function matches the name used in the structure member above.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">uint32_t g_transferDoneFlag = 0;</div>
<div class="line"></div>
<div class="line">static <span class="keywordtype">void</span> spi_Dma_Done(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* set the global flag to indicate transfer done */</span></div>
<div class="line">    g_transferDoneFlag = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h1>De-initialization</h1>
To de-initialize or shut down the SPI module, call the function: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__spi__slave__driver.html#ga0c716f5dfe61caa7064a5ba8d39b0280">SPI_DRV_SlaveDeinit</a>(slaveInstance);</div>
</div><!-- fragment --> </div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structspi__slave__callbacks__t" id="structspi__slave__callbacks__t"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct spi_slave_callbacks_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"></div><table class="memberdecls">
<tr><td colspan="2"><h3>Data Fields</h3></td></tr>
<tr class="memitem:a6066290d2a7cc21f09042381f4433cdd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a6066290d2a7cc21f09042381f4433cdd">dataSource</a> )(uint8_t *sourceByte, uint32_t instance)</td></tr>
<tr class="memdesc:a6066290d2a7cc21f09042381f4433cdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to get byte to transmit.  <a href="#a6066290d2a7cc21f09042381f4433cdd">More...</a><br/></td></tr>
<tr class="separator:a6066290d2a7cc21f09042381f4433cdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a816f6cc0a2d4fa093100080f4a824c2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a816f6cc0a2d4fa093100080f4a824c2d">dataSink</a> )(uint8_t sinkByte, uint32_t instance)</td></tr>
<tr class="memdesc:a816f6cc0a2d4fa093100080f4a824c2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to put received byte.  <a href="#a816f6cc0a2d4fa093100080f4a824c2d">More...</a><br/></td></tr>
<tr class="separator:a816f6cc0a2d4fa093100080f4a824c2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a756904ea43a3e516f4602b49cb639278"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a756904ea43a3e516f4602b49cb639278">onError</a> )(<a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a> error, uint32_t instance)</td></tr>
<tr class="memdesc:a756904ea43a3e516f4602b49cb639278"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback used to report an SPI error.  <a href="#a756904ea43a3e516f4602b49cb639278">More...</a><br/></td></tr>
<tr class="separator:a756904ea43a3e516f4602b49cb639278"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb9fcf076192e29b73459c03295484c9"><td class="memItemLeft" align="right" valign="top">void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#adb9fcf076192e29b73459c03295484c9">spi_slave_done_t</a> )(void)</td></tr>
<tr class="memdesc:adb9fcf076192e29b73459c03295484c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to report the slave SPI DMA is done transferring data.  <a href="#adb9fcf076192e29b73459c03295484c9">More...</a><br/></td></tr>
<tr class="separator:adb9fcf076192e29b73459c03295484c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h4 class="groupheader">Field Documentation</h4>
<a class="anchor" id="a6066290d2a7cc21f09042381f4433cdd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a>(* spi_slave_callbacks_t::dataSource)(uint8_t *sourceByte, uint32_t instance)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a816f6cc0a2d4fa093100080f4a824c2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a>(* spi_slave_callbacks_t::dataSink)(uint8_t sinkByte, uint32_t instance)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a756904ea43a3e516f4602b49cb639278"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* spi_slave_callbacks_t::onError)(<a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a> error, uint32_t instance)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="adb9fcf076192e29b73459c03295484c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void(* spi_slave_callbacks_t::spi_slave_done_t)(void)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Used only for DMA enabled slave SPI operation and not used for interrupt operation. </p>

</div>
</div>

</div>
</div>
<a name="structspi__slave__state__t" id="structspi__slave__state__t"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct spi_slave_state_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>This structure holds data that is used by the SPI slave peripheral driver to communicate between the transfer function and the interrupt handler. The user needs to pass in the memory for this structure and the driver fills out the members. </p>
</div><table class="memberdecls">
<tr><td colspan="2"><h3>Data Fields</h3></td></tr>
<tr class="memitem:a2fba80855e18afbf379a98567574c32d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2fba80855e18afbf379a98567574c32d"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a2fba80855e18afbf379a98567574c32d">instance</a></td></tr>
<tr class="memdesc:a2fba80855e18afbf379a98567574c32d"><td class="mdescLeft">&#160;</td><td class="mdescRight">DSPI module instance number. <br/></td></tr>
<tr class="separator:a2fba80855e18afbf379a98567574c32d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06f36341155f138e0ec9e1151c3940fa"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a06f36341155f138e0ec9e1151c3940fa"></a>
<a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a06f36341155f138e0ec9e1151c3940fa">callbacks</a></td></tr>
<tr class="memdesc:a06f36341155f138e0ec9e1151c3940fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Application/user callbacks. <br/></td></tr>
<tr class="separator:a06f36341155f138e0ec9e1151c3940fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae78082d4a7a190e9f1355b5ad7598244"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae78082d4a7a190e9f1355b5ad7598244"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>useDma</b></td></tr>
<tr class="separator:ae78082d4a7a190e9f1355b5ad7598244"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc3d4b4fc6a611a25169a4e4ca05708e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc3d4b4fc6a611a25169a4e4ca05708e"></a>
<a class="el" href="group__dma__driver.html#structdma__channel__t">dma_channel_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>dmaReceive</b></td></tr>
<tr class="separator:afc3d4b4fc6a611a25169a4e4ca05708e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a148c62a1762367f958bd09da3fa6e156"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a148c62a1762367f958bd09da3fa6e156"></a>
<a class="el" href="group__dma__driver.html#structdma__channel__t">dma_channel_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>dmaTransmit</b></td></tr>
<tr class="separator:a148c62a1762367f958bd09da3fa6e156"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>

</div>
</div>
<a name="structspi__slave__user__config__t" id="structspi__slave__user__config__t"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct spi_slave_user_config_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>functions used by the SPI slave driver. </p>
</div><table class="memberdecls">
<tr><td colspan="2"><h3>Data Fields</h3></td></tr>
<tr class="memitem:a31ffb0aefd629bd78e352ff7f7ca55d5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a31ffb0aefd629bd78e352ff7f7ca55d5">callbacks</a></td></tr>
<tr class="memdesc:a31ffb0aefd629bd78e352ff7f7ca55d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Application callbacks.  <a href="#a31ffb0aefd629bd78e352ff7f7ca55d5">More...</a><br/></td></tr>
<tr class="separator:a31ffb0aefd629bd78e352ff7f7ca55d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a421ac6406636a059ebbb874d8b25edb3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#ga9ad313685ade497f5cbcb71c74a1b4dc">spi_clock_phase_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a421ac6406636a059ebbb874d8b25edb3">phase</a></td></tr>
<tr class="memdesc:a421ac6406636a059ebbb874d8b25edb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clock phase setting.  <a href="#a421ac6406636a059ebbb874d8b25edb3">More...</a><br/></td></tr>
<tr class="separator:a421ac6406636a059ebbb874d8b25edb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a82acc2f86bf8d78ce3a489ba720760"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#ga3e5a7cd043c9596779bc23b34cb3d1f9">spi_clock_polarity_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a5a82acc2f86bf8d78ce3a489ba720760">polarity</a></td></tr>
<tr class="memdesc:a5a82acc2f86bf8d78ce3a489ba720760"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clock polarity setting.  <a href="#a5a82acc2f86bf8d78ce3a489ba720760">More...</a><br/></td></tr>
<tr class="separator:a5a82acc2f86bf8d78ce3a489ba720760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a817f018aa9558eb4b153682a6d15d1a2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__spi__hal.html#gaa68518c16202382c2e1f1c7c66a9d53d">spi_shift_direction_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html#a817f018aa9558eb4b153682a6d15d1a2">direction</a></td></tr>
<tr class="memdesc:a817f018aa9558eb4b153682a6d15d1a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Either LSB or MSB first.  <a href="#a817f018aa9558eb4b153682a6d15d1a2">More...</a><br/></td></tr>
<tr class="separator:a817f018aa9558eb4b153682a6d15d1a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h4 class="groupheader">Field Documentation</h4>
<a class="anchor" id="a31ffb0aefd629bd78e352ff7f7ca55d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t">spi_slave_callbacks_t</a> spi_slave_user_config_t::callbacks</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a421ac6406636a059ebbb874d8b25edb3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#ga9ad313685ade497f5cbcb71c74a1b4dc">spi_clock_phase_t</a> spi_slave_user_config_t::phase</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a5a82acc2f86bf8d78ce3a489ba720760"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#ga3e5a7cd043c9596779bc23b34cb3d1f9">spi_clock_polarity_t</a> spi_slave_user_config_t::polarity</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a817f018aa9558eb4b153682a6d15d1a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#gaa68518c16202382c2e1f1c7c66a9d53d">spi_shift_direction_t</a> spi_slave_user_config_t::direction</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga4b3c6d8bc1e7a39be0c66a7185f3d404"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPI_DRV_SlaveInit </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> *&#160;</td>
          <td class="paramname"><em>spiState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> *&#160;</td>
          <td class="paramname"><em>config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Saves the application callback info, turns on the clock to the module, enables the device, and enables interrupts. Sets the SPI to a slave mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>Instance number of the SPI module. </td></tr>
    <tr><td class="paramname">spiState</td><td>The pointer to the SPI slave driver state structure. </td></tr>
    <tr><td class="paramname">config</td><td>Pointer to slave mode configuration. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaa181e9e53d025cfde1ee70c503dde448"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a> SPI_DRV_SlaveInitDma </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t">spi_slave_state_t</a> *&#160;</td>
          <td class="paramname"><em>spiState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t">spi_slave_user_config_t</a> *&#160;</td>
          <td class="paramname"><em>slaveConfig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>sendBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>receiveBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>transferByteCount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is exactly like the SPI_DRV_SlaveInit function except that it also adds the DMA support. This function saves the callbacks to the run-time state structure for later use in the interrupt handler. However, unlike the CPU driven slave driver, there is no need to define callbacks for the data sink or data source since the user passes in buffers for the send and receive data, and the DMA engine uses those buffers. An onError callback is needed to service potential errors seen during a Tx FIFO underflow or Rx FIFO overflow. The user also passes in a user defined callback for handling end of transfers of type spi_slave_done_t. These callbacks are set in the <a class="el" href="group__spi__slave__driver.html#structspi__slave__callbacks__t" title="The set of callbacks used for SPI slave mode. ">spi_slave_callbacks_t</a> structure which is part of the <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t" title="Definition of application implemented configuration and callback. ">spi_slave_user_config_t</a> structure. See example below. This function also ungates the clock to the SPI module, initializes the SPI for slave mode, enables the module and corresponding interrupts, and sets up the DMA channels. Once initialized, the SPI module is configured in slave mode and ready to receive data from the SPI master. This is an example to set up the <a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t" title="Runtime state of the SPI slave driver. ">spi_slave_state_t</a> and the <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t" title="Definition of application implemented configuration and callback. ">spi_slave_user_config_t</a> parameters and to call the SPI_DRV_SlaveInit function by passing in these parameters: instance = slaveInstance; &lt;- the desired module instance number <a class="el" href="group__spi__slave__driver.html#structspi__slave__state__t" title="Runtime state of the SPI slave driver. ">spi_slave_state_t</a> spiSlaveState; &lt;- the user simply allocates memory for this struct <a class="el" href="group__spi__slave__driver.html#structspi__slave__user__config__t" title="Definition of application implemented configuration and callback. ">spi_slave_user_config_t</a> slaveUserConfig; slaveUserConfig.callbacks.onError = on_error; &lt;- set to user implementation of function slaveUserConfig.callbacks.spi_slave_done_t = spiDmaDone; &lt;- user defined callback slaveUserConfig.dataConfig.clkPhase = kSpiClockPhase_FirstEdge; &lt;- example setting slaveUserConfig.dataConfig.clkPolarity = kSpiClockPolarity_ActiveHigh; &lt;- example setting sendBuffer &lt;- (pointer) to the source data buffer, can be NULL receiveBuffer &lt;- (pointer) to the receive data buffer, can be NULL transferCount &lt;- number of bytes to transfer</p>
<p>SPI_DRV_SlaveInitDma(slaveInstance, &amp;slaveUserConfig, &amp;spiSlaveState, &amp;sendBuffer, &amp;receiveBuffer, transferCount);</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>The instance number of the SPI peripheral. </td></tr>
    <tr><td class="paramname">spiState</td><td>The pointer to the SPI slave driver state structure. </td></tr>
    <tr><td class="paramname">slaveConfig</td><td>The configuration structure <a class="el" href="group__dspi__slave__driver.html#structdspi__slave__user__config__t" title="User configuration structure and callback functions for the DSPI slave driver. ">dspi_slave_user_config_t</a>, including the callbacks. </td></tr>
    <tr><td class="paramname">sendBuffer</td><td>The pointer to the data buffer of the data to send. You may pass NULL for this parameter, in which case bytes with a value of 0 (zero) are sent. </td></tr>
    <tr><td class="paramname">receiveBuffer</td><td>Pointer to the buffer where the received bytes are stored. If you pass NULL for this parameter, the received bytes are ignored. </td></tr>
    <tr><td class="paramname">transferByteCount</td><td>The expected number of bytes to transfer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An error code or kStatus_SPI_Success. </dd></dl>

</div>
</div>
<a class="anchor" id="ga0c716f5dfe61caa7064a5ba8d39b0280"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SPI_DRV_SlaveDeinit </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clears the control register and turns off the clock to the module.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">instance</td><td>Instance number of the SPI module. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Fri Jul 25 2014 &copy; 2014 Freescale Semiconductor, Inc. All rights reserved. 
    </li>
  </ul>
</div>
</body>
</html>
