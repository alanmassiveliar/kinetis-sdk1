<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Kinetis SDK API Reference Manual: Serial Peripheral Interface (SPI)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK API Reference Manual
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Usage</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__spi.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Serial Peripheral Interface (SPI)</div>  </div>
</div><!--header-->
<div class="contents">

<p>The Kinetis SDK provides both HAL and Peripheral drivers for the Serial Peripheral Interface (SPI) block of Kinetis devices.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__spi__classes"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__classes.html">SPI Classes</a></td></tr>
<tr class="memdesc:group__spi__classes"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the SPI driver C++ classes. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__spi__hal"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__hal.html">SPI HAL driver</a></td></tr>
<tr class="memdesc:group__spi__hal"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the programming interface of the SPI HAL driver. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__SPI__DRV__MasterDriver"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SPI__DRV__MasterDriver.html">SPI Master Peripheral Driver</a></td></tr>
<tr class="memdesc:group__SPI__DRV__MasterDriver"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the programming interface of the SPI master mode Peripheral driver. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__spi__slave__driver"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__slave__driver.html">SPI Slave Peripheral Driver</a></td></tr>
<tr class="memdesc:group__spi__slave__driver"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the programming interface of the SPI slave mode Peripheral driver. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__spi__types"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__spi__types.html">Shared SPI Types</a></td></tr>
<tr class="memdesc:group__spi__types"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes SPI driver shared types. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>


<h3><a class="anchor" id="spimaster"></a>SPI Master Peripheral Driver</h3><div class="textblock"><h1>Overview</h1>
The SPI master mode Peripheral driver transfers data to and from the external devices on the SPI bus in master mode. It provides an easy way to transfer buffers of data with a single function call.<h1>Run-time state structures</h1>
The SPI master driver uses a run-time state structure, <a class="el" href="group__SPI__DRV__MasterDriver.html#structspi__master__state__t" title="Runtime state of the SPI master driver. ">spi_master_state_t</a>, to track the ongoing data transfer. The structure holds data that the SPI master peripheral driver uses to communicate between the transfer function and the interrupt handler. The interrupt handler also uses this information to keep track of its progress. The user is only responsible to pass the memory for this run-time state structure and the SPI master driver fills out the members.<h1>Device structures</h1>
The driver uses instances of the #spi_device_t structure to represent the SPI bus configuration required to communicate the bus connectivity to an external device.The device structures can be passed to the data transfer functions and the bus is reconfigured before the transfer is started. Alternatively, you can manually configure the SPI bus for a device. For example, if there is only one device connected to the bus, you might configure it only once.<h1>Initialization</h1>
To initialize the SPI master driver, call the <a class="el" href="group__SPI__DRV__MasterDriver.html#gac2a54d321a7f9e25e8f61f156a7f1375" title="Initializes an SPI instance for master mode operation. ">SPI_DRV_MasterInit()</a> function and pass the instance number of the SPI peripheral you want to use. For example, to use the SPI1, pass a value of 1 to the initialization function.The user passes in a device structure that represents the characteristics of the SPI bus including the desired baud rate. Note that, in some cases, the exact baud rate cannot be achieved. Instead, the closest matching baud rate is returned via the calculatedBaudRate parameter. Note that this parameter never exceeds the desired baud rate. An example device structure usage and SPI initialization is as follows:This is an example code to initialize and configure the driver: </p>
<div class="fragment"><div class="line">uint32_t masterInstance = 1;</div>
<div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#structspi__master__state__t">spi_master_state_t</a> spiMasterState;</div>
<div class="line">uint32_t calculatedBaudRate;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Define bus configuration.</span></div>
<div class="line">spi_device_t device = {</div>
<div class="line">        .bitsPerSec = 1000,</div>
<div class="line">        .polarity = <a class="code" href="group__spi__hal.html#gga3e5a7cd043c9596779bc23b34cb3d1f9a0b33c8e75da2f2c6a2e821f94cc77f46">kSpiClockPolarity_ActiveHigh</a>,</div>
<div class="line">        .phase = <a class="code" href="group__spi__hal.html#gga9ad313685ade497f5cbcb71c74a1b4dca58859ca1e960ebb8f6e1121997c6fbbe">kSpiClockPhase_SecondEdge</a>,</div>
<div class="line">        .direction = <a class="code" href="group__spi__hal.html#ggaa68518c16202382c2e1f1c7c66a9d53daefa27165c331b1503fd02a79099e8dfe">kSpiMsbFirst</a></div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"><span class="comment">// Init driver.</span></div>
<div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#gac2a54d321a7f9e25e8f61f156a7f1375">SPI_DRV_MasterInit</a>(masterInstance, &amp;spiMasterState);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Configure bus.</span></div>
<div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#ga0562675eefc63ce119738e9f11b7b55f">SPI_DRV_MasterConfigureBus</a>(masterInstance, &amp;device, &amp;calculatedBaudRate);</div>
</div><!-- fragment -->Additionally, the SPI supports DMA transfers. To use the SPI with DMA, call an alternate initialization function, SPI_DRV_MasterInitDma. The user still needs to call the <a class="el" href="group__SPI__DRV__MasterDriver.html#ga0562675eefc63ce119738e9f11b7b55f" title="Configures the SPI port to access a device on the bus. ">SPI_DRV_MasterConfigureBus()</a> function. In addition to initialization of the SPI interface, it is also necessary to configure the SPI to match the parameters needed by the peripheral device as mentioned above.<div class="fragment"><div class="line"><span class="comment">/* Function prototype */</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__SPI__DRV__MasterDriver.html#gaf603ea64aaef4ac79787833e9994f13c">SPI_DRV_MasterInitDma</a>(uint32_t instance, <a class="code" href="group__SPI__DRV__MasterDriver.html#structspi__master__state__t">spi_master_state_t</a> * spiState);</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#ga0562675eefc63ce119738e9f11b7b55f">SPI_DRV_MasterConfigureBus</a>(masterInstance, &amp;device, &amp;calculatedBaudRate);</div>
</div><!-- fragment --><h1>Transfers</h1>
The driver supports two different modes to transfer data: blocking and non-blocking. The blocking transfer function is the <a class="el" href="group__SPI__DRV__MasterDriver.html#ga77133f2bf25abd2fee5bd173f9d6d88a" title="Performs a non-blocking SPI master mode transfer. ">SPI_DRV_MasterTransfer()</a>.This is an example of a blocking transfer: </p>
<div class="fragment"><div class="line">uint8_t sendBuf[] = { 0, 1, 2, 3 };</div>
<div class="line">uint8_t receiveBuf[<span class="keyword">sizeof</span>(sendBuf)];</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#ga77133f2bf25abd2fee5bd173f9d6d88a">SPI_DRV_MasterTransfer</a>(masterInstance,  <span class="comment">// SPI peripheral instance</span></div>
<div class="line">    &amp;device,            <span class="comment">// Device SPI bus configuration</span></div>
<div class="line">    sendBuf,            <span class="comment">// Data to send</span></div>
<div class="line">    receiveBuf,         <span class="comment">// Buffer to hold received data</span></div>
<div class="line">    <span class="keyword">sizeof</span>(sendBuf),    <span class="comment">// Number of bytes to transfer</span></div>
<div class="line">    <a class="code" href="group__SPI__DRV__MasterDriver.html#gga427122f80e42b2207809b5a89cc58131a2bb5fb851db88e497ad03eff0ced1b6b">kSpiWaitForever</a>);   <span class="comment">// No timeout</span></div>
</div><!-- fragment -->This is an example of a non-blocking transfer: </p>
<div class="fragment"><div class="line">uint8_t sendBuf[] = { 0, 1, 2, 3 };</div>
<div class="line">uint8_t receiveBuf[<span class="keyword">sizeof</span>(sendBuf)];</div>
<div class="line"></div>
<div class="line"><span class="comment">// Start the transfer.</span></div>
<div class="line">SPI_DRV_MasterTransfer_async(masterInstance,  <span class="comment">// SPI peripheral instance</span></div>
<div class="line">    &amp;device,            <span class="comment">// Device SPI bus configuration</span></div>
<div class="line">    sendBuf,            <span class="comment">// Data to send</span></div>
<div class="line">    receiveBuf,         <span class="comment">// Buffer to hold received data</span></div>
<div class="line">    <span class="keyword">sizeof</span>(sendBuf));   <span class="comment">// Number of bytes to transfer</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Wait for the transfer to complete.</span></div>
<div class="line"><span class="keywordflow">while</span> (<a class="code" href="group__SPI__DRV__MasterDriver.html#ga9da12d9f561f8060d63a33010491ff8c">SPI_DRV_MasterGetTransferStatus</a>(0, NULL) == <a class="code" href="group__spi__hal.html#gga856ecadf3d7fe18c4fc3ae56500f8982a703abdf7900047c4d13536480f3463ab">kStatus_SPI_Busy</a>)</div>
<div class="line">{</div>
<div class="line">}</div>
</div><!-- fragment -->For non-blocking/async transfers, check back to get the transfer status as shown above. Another example where framesXfer returns the number of frames transferred: </p>
<div class="fragment"><div class="line"><a class="code" href="group__SPI__DRV__MasterDriver.html#ga9da12d9f561f8060d63a33010491ff8c">SPI_DRV_MasterGetTransferStatus</a>(masterInstance, &amp;framesXfer);</div>
</div><!-- fragment -->To abort a transfer, simply call: </p>
<div class="fragment"><div class="line"><a class="code" href="group__spi__hal.html#ga856ecadf3d7fe18c4fc3ae56500f8982">spi_status_t</a> <a class="code" href="group__SPI__DRV__MasterDriver.html#ga761f1f44413fd6a0b61250de28ed8c97">SPI_DRV_MasterAbortTransfer</a>(masterInstance);</div>
</div><!-- fragment --><h1>De-initialization</h1>
To de-initialize or shut down the SPI module, call the function: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__SPI__DRV__MasterDriver.html#ga4c527845207e4dd38e6ed8dfd94ee31d">SPI_DRV_MasterDeinit</a>(masterInstance);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Fri Jul 25 2014 &copy; 2014 Freescale Semiconductor, Inc. All rights reserved. 
    </li>
  </ul>
</div>
</body>
</html>
