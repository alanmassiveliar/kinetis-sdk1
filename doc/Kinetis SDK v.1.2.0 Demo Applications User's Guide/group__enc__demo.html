<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Kinetis SDK v.1.2 Demo Applications User&#39;s Guide: Quadrature Encoder Demo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fs_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis SDK v.1.2 Demo Applications User&#39;s Guide
   &#160;<span id="projectnumber">Rev. 0</span>
   </div>
   <div id="projectbrief">Freescale Semiconductor, Inc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Demos</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__enc__demo.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Quadrature Encoder Demo</div>  </div>
</div><!--header-->
<div class="contents">

<p>This demo application demonstrates the Quadrature Encoder demo.  
<a href="#details">More...</a></p>
<h1>Overview</h1>
<p>This application demonstrates the Quadrature Encoder decoder function. It decodes quadrature signals and outputs position on LEDs.</p>
<h1>Supported Platforms</h1>
<p>This Freescale Tower System development platform is supported by the Kinetis software development kit enc demo.</p>
<ul>
<li>TWR-KV46F150M</li>
</ul>
<h1><a class="anchor" id="SR"></a>
System Requirement</h1>
<h2><a class="anchor" id="HwR"></a>
Hardware requirements</h2>
<ul>
<li>J-Link ARM</li>
<li>PE Micro Multi-link universal</li>
<li>Mini/micro USB cable</li>
<li>USB A to micro AB cable</li>
<li>Hardware (tower/base board, ...) for specific device</li>
<li>Personal Computer</li>
</ul>
<h2><a class="anchor" id="ToR"></a>
Toolchain requirements</h2>
<ul>
<li>IAR embedded Workbench version 7.30.4</li>
<li>ARM GCC 4.8.3 2014q3</li>
<li>Keil MDK 5.13</li>
<li>Kinetis Design Studio IDE v.2.5.0</li>
<li>Atollic TrueSTUDIO for ARM win32 v5.2.1</li>
</ul>
<h2><a class="anchor" id="SDKReq"></a>
Software requirements</h2>
<ul>
<li>The project files are in: &lt;SDK_Install&gt;/examples/&lt;board&gt;/demo_apps/enc_demo/&lt;toolchain&gt;.</li>
<li>Library dependencies: ksdk_platform_lib</li>
</ul>
<h1>Getting Started</h1>
<h2>Hardware configuration</h2>
<p>For the Freescale TWR-KV46F150M board, connect encoder quadrature outputs to XBARA input pins.</p>
<div> <table class="doxtable">
<tr>
<th rowspan="2" align="center">Platform </th><th colspan="4" align="center">Inputs  </th></tr>
<tr>
<th align="center">PHASE A </th><th align="center">PHASE B </th><th align="center">INDEX </th><th align="center">HOME  </th></tr>
<tr>
<th>TWR-KV46F150M </th><td align="center">J1-2 </td><td align="center">J1-4 </td><td align="center">J501-26 </td><td align="center">N/A  </td></tr>
</table>
</div><h2><a class="anchor" id="PtD"></a>
Prepare the Demo</h2>
<ol type="1">
<li>Connect a USB cable between the PC host and the OpenSDA USB port on the board.</li>
<li>Open a serial terminal with these settings:<ul>
<li>115200 baud rate</li>
<li>8 data bits</li>
<li>No parity</li>
<li>One stop bit</li>
<li>No flow control</li>
</ul>
</li>
<li>Download the program to the target board.</li>
<li>Either press the reset button on your board or launch the debugger in your IDE to begin running the demo.</li>
</ol>
<h1><a class="anchor" id="RtD"></a>
Run the demo</h1>
<ol type="1">
<li>Terminal prints the message "Welcome to Quad ENC demo!"</li>
<li>Move encoder to detect INDEX pulse which starts to show shaft position on 6 LEDs and terminal prints "INDEX pulse detected!"</li>
<li>The LED on board switches on/off according to shaft position and direction of shaft move is shown, too.</li>
<li>One turn of the shaft is presented with 6 LED switching.</li>
</ol>
<h1>Simulate encoder</h1>
<p>If there is not any real encoder, the source code below can be used to simulate an encoder. It was tested on TWR-K21D50M.</p>
<div> <table class="doxtable">
<tr>
<th rowspan="2" align="center">Platform </th><th colspan="4" align="center">Outputs  </th></tr>
<tr>
<th align="center">PHASE A </th><th align="center">PHASE B </th><th align="center">INDEX </th><th align="center">HOME  </th></tr>
<tr>
<th>TWR-K21D50M </th><td align="center">J15-1 </td><td align="center">J15-3 </td><td align="center">J15-5 </td><td>N/A  </td></tr>
</table>
</div><div class="fragment"><div class="line">    <span class="comment">//  Includes</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// SDK Included Files</span></div>
<div class="line"><span class="preprocessor">    #include &quot;board.h&quot;</span></div>
<div class="line"><span class="preprocessor">    #include &quot;fsl_lptmr_driver.h&quot;</span></div>
<div class="line"><span class="preprocessor">    #include &quot;fsl_debug_console.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #define ENCODER_PULSES          1024</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #define PHASE_A_PORT            PORTD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_A_GPIO            GPIOD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_A_PORT_PIN        4u</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_A_PORT_INS        PORTD_IDX</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #define PHASE_B_PORT            PORTD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_B_GPIO            GPIOD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_B_PORT_PIN        5u</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_B_PORT_INS        PORTD_IDX</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">    #define PHASE_INDEX_PORT        PORTD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_INDEX_GPIO        GPIOD</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_INDEX_PORT_PIN    6u</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define PHASE_INDEX_PORT_INS    PORTD_IDX</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// Code</span></div>
<div class="line"><span class="comment"></span>    <span class="keyword">static</span> <span class="keywordtype">void</span> enable_squareWave(<span class="keywordtype">void</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Enable clock for ports of Phase A, B and INDEX if necessary */</span></div>
<div class="line">        CLOCK_SYS_EnablePortClock(PHASE_A_PORT_INS);</div>
<div class="line">    <span class="comment">//  CLOCK_SYS_EnablePortClock(PHASE_B_PORT_INS);</span></div>
<div class="line">    <span class="comment">//  CLOCK_SYS_EnablePortClock(PHASE_INDEX_PORT_INS);</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Create square wave for phase A*/</span></div>
<div class="line">        PORT_HAL_SetMuxMode(PHASE_A_PORT,PHASE_A_PORT_PIN,kPortMuxAsGpio);</div>
<div class="line">        GPIO_HAL_SetPinDir(PHASE_A_GPIO,PHASE_A_PORT_PIN,kGpioDigitalOutput);</div>
<div class="line">        <span class="comment">/* Create square wave for phase A*/</span></div>
<div class="line">        PORT_HAL_SetMuxMode(PHASE_B_PORT,PHASE_B_PORT_PIN,kPortMuxAsGpio);</div>
<div class="line">        GPIO_HAL_SetPinDir(PHASE_B_GPIO,PHASE_B_PORT_PIN,kGpioDigitalOutput);</div>
<div class="line">        <span class="comment">/* Create signal index for INDEX_pin*/</span></div>
<div class="line">        PORT_HAL_SetMuxMode(PHASE_INDEX_PORT,PHASE_INDEX_PORT_PIN,kPortMuxAsGpio);</div>
<div class="line">        GPIO_HAL_SetPinDir(PHASE_INDEX_GPIO,PHASE_INDEX_PORT_PIN,kGpioDigitalOutput);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="demo__apps_2adc__hw__trigger_2main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (<span class="keywordtype">void</span>)</div>
<div class="line">    {</div>
<div class="line">        uint32_t <a class="code" href="driver__examples_2slcd_2main_8c.html#aae6e2c31dff0df5ef04fdda33a94d8ea">i</a>;</div>
<div class="line"></div>
<div class="line">        hardware_init();</div>
<div class="line">        OSA_Init();</div>
<div class="line">        enable_squareWave();</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span>(1)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="demo__apps_2enc__demo_2main_8c.html#a76bcc6878177c7eae1f36e9d6533fa02">ENCODER_PULSES</a>; i++)</div>
<div class="line">            {</div>
<div class="line">                GPIO_HAL_TogglePinOutput(PHASE_A_GPIO, 4u);</div>
<div class="line">                OSA_TimeDelay(1);</div>
<div class="line">                GPIO_HAL_TogglePinOutput(PHASE_B_GPIO, 5u);</div>
<div class="line">                <span class="keywordflow">if</span>(i == 0)</div>
<div class="line">                {</div>
<div class="line">                    GPIO_HAL_SetPinOutput(PHASE_INDEX_GPIO, 6u);</div>
<div class="line">                    OSA_TimeDelay(1);</div>
<div class="line">                    GPIO_HAL_ClearPinOutput(PHASE_INDEX_GPIO, 6u);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                {</div>
<div class="line">                    OSA_TimeDelay(1);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer">Mon Apr 27 2015 &copy; 2015 Freescale Semiconductor, Inc. All rights reserved.
    </li>
  </ul>
</div>
</body>
</html>
